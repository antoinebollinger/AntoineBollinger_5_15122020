document.addEventListener("click",(function(e){if(e.target)switch(e.target.dataset.action){case"addToCart":e.preventDefault();const myColor=document.getElementById("selectColor"),myQty=document.getElementById("inputQty");addToCart(e.target.dataset.id,parseInt(myQty.value),myColor.value,e.target.dataset.price);break;case"refreshCart":e.preventDefault();const myIndex=e.target.dataset.index,myNewQty=document.getElementById("quantite_"+myIndex);refreshCart(myIndex,myNewQty.value);break;case"removeFromCart":e.preventDefault(),removeFromCart(e.target.dataset.index);break;case"clearCart":e.preventDefault(),clearCart();break;case"checkoutCart":checkoutCart()}})),document.addEventListener("change",(function(e){refreshCart(e.target.dataset.index,e.target.value)}));const cartDiv=document.getElementById("cartDiv");function addToCart(_id,_qty,_color,_price){let myCart=JSON.parse(window.localStorage.getItem("products"));if(checkIsInCart(myCart,_id,_qty,_color)){const newProduct={id:_id,color:_color,quantity:_qty,price:_price};myCart.push(newProduct),updateCart(myCart,{clear:!1}),divLatH2.innerHTML="Votre nounours a bien été ajouté au panier.",divLateral.classList.add("active")}}function refreshCart(_index,_quantity){let myCart=JSON.parse(window.localStorage.getItem("products"));for(let ele of myCart)myCart.indexOf(ele)==_index&&(ele.quantity=parseInt(_quantity));updateCart(myCart,{clear:!1})}function removeFromCart(_index){let myCart=JSON.parse(window.localStorage.getItem("products"));confirm("Êtes-vous certain de vouloir supprimer ce produit de votre panier ?")&&(_index>-1&&myCart.splice(_index,1),updateCart(myCart,{clear:!1}))}function clearCart(){0!=sizeCart()&&confirm("Êtes-vous certain de vouloir vider le panier ?")&&updateCart("",{clear:!0})}function sizeCart(){const myCart=JSON.parse(window.localStorage.getItem("products"));return myCart.length}function totalCart(){const myCart=JSON.parse(window.localStorage.getItem("products"));let total=0;for(let ele of myCart)total+=parseInt(ele.quantity)*parseFloat(ele.price/100);return total}function checkIsInCart(_cart,_id,_qty,_color){let valid=!0;for(let ele of _cart)ele.id==_id&&ele.color==_color&&(confirm("Cet article est déjà présent dans votre panier. Souhaitez-vous augmenter la quantité ?")&&(ele.quantity+=parseInt(_qty),updateCart(_cart,{clear:!1}),divLatH2.innerHTML="Votre nounours a bien été ajouté au panier.",divLateral.classList.add("active")),valid=!1);return valid}function checkoutCart(){const myCart=JSON.parse(window.localStorage.getItem("products"));console.log("on commande ça :"),console.log(myCart)}function displayCart(){if("panier.html"==currentUrl){initializeCart(),cartDiv.innerHTML="";const myCart=JSON.parse(window.localStorage.getItem("products"));for(let ele of myCart)displayProduct(ele,myCart.indexOf(ele));const totalCartDiv=document.getElementById("totalCart"),mytotalCart=totalCart();totalCartDiv.innerHTML=displayPrice(mytotalCart)}}async function displayProduct(array,index){await fetch(apiUrl+array.id).then(response=>response.json()).then(nounours=>createItem(nounours,index,array.color,array.quantity))}function createItem(array,_index,_color,_quantity){const newProduct=createEle("div","",["row","cart-product"],"","",cartDiv),newDivImg=createEle("div","",["col-2","col-sm-2","col-md-2","text-center"],"","",newProduct);createEle("img","",["img-responsive"],{src:array.imageUrl,alt:"preview",width:120,height:80},"",newDivImg);const newDivInfo=createEle("div","",["col-5","col-sm-5","col-md-5","text-sm-center","text-md-left"],"","",newProduct);createEle("h2","",["product-name"],"",'<a href="product.html?myId='+array._id+'">'+array.name+"</a>",newDivInfo),createEle("p","","","","Couleur : "+_color,newDivInfo);const newProductSub=createEle("div","",["col-5","col-sm-5","col-md-5","text-sm-center","text-md-right","row"],"","",newProduct),newDivPrix=createEle("div","",["col","col-sm","col-md","text-md-right"],{style:"padding-top:5px"},"",newProductSub);createEle("h2","","","",displayPrice(array.price/100)+'&nbsp;<span class="text-muted">x</span>&nbsp;',newDivPrix);const newDivQte=createEle("div","",["col","col-sm","col-md"],"","",newProductSub),newDivQteSub=createEle("div","",["quantity"],"","",newDivQte);createEle("input","quantite_"+_index,["qty"],{type:"number",value:_quantity,step:1,min:1,title:"Qty",size:4,"data-index":_index},"",newDivQteSub);const newDivActualiser=createEle("div","",["col","col-sm","col-md","text-right"],"","",newProductSub);createEle("a","",["btn","btn-primary","a-refresh"],{href:"#","data-index":_index,"data-action":"refreshCart",title:"Actualiser le panier"},'<i class="fas fa-sync-alt"></i>',newDivActualiser);const newDivSupprimer=createEle("div","",["col","col-sm","col-md","text-right"],"","",newProductSub);createEle("a","",["btn","btn-primary"],{href:"#","data-index":_index,"data-action":"removeFromCart",title:"Supprimer ce produit"},'<i class="fa fa-trash"></i>',newDivSupprimer)}function initializeCart(){if("undefined"!=typeof Storage){null===window.localStorage.getItem("products")&&window.localStorage.setItem("products",JSON.stringify([]));const displayQtyCart=document.getElementById("qtePanier"),myCart=JSON.parse(window.localStorage.getItem("products"));let displayTotal=!1;if(0==myCart.length)displayQtyCart.style.visibility="hidden";else{displayQtyCart.style.visibility="visible",nbr=0;for(let ele of myCart)nbr+=parseInt(ele.quantity);displayQtyCart.innerHTML=nbr,displayTotal=!0}if("panier.html"==currentUrl){const displayTotalCart=document.getElementById("div-total"),buttonCheckout=document.getElementById("checkoutCart");displayTotal?(displayTotalCart.style.visibility="visible",buttonCheckout.classList.remove("disabled")):(displayTotalCart.style.visibility="hidden",buttonCheckout.classList.add("disabled"))}}else console.log("error")}function updateCart(array,options){options.clear?window.localStorage.clear():(window.localStorage.removeItem("products"),window.localStorage.setItem("products",JSON.stringify(array.sort()))),initializeCart(),displayCart()}initializeCart(),displayCart();
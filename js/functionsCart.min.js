function addToCart(object){let myCart=JSON.parse(window.localStorage.getItem("products"));checkIsInCart(myCart,{id:object.id,quantity:object.quantity,color:object.color})&&(myCart.push(object),updateCart(myCart,{clear:!1}),divLatH2.innerHTML="Votre nounours a bien été ajouté au panier.",divLateral.classList.add("active"))}function refreshCart(object){let myCart=JSON.parse(window.localStorage.getItem("products"));for(let ele of myCart)myCart.indexOf(ele)==object.index&&(ele.quantity=parseInt(object.quantity));updateCart(myCart,{clear:!1})}function removeFromCart(index){let myCart=JSON.parse(window.localStorage.getItem("products"));confirm("Êtes-vous certain de vouloir supprimer ce produit de votre panier ?")&&(index>-1&&myCart.splice(index,1),updateCart(myCart,{clear:!1}))}function clearCart(options){const myCart=JSON.parse(window.localStorage.getItem("products"));0!=myCart.length&&(options.confirm?confirm("Êtes-vous certain de vouloir vider le panier ?")&&updateCart("",{clear:!0}):updateCart("",{clear:!0}))}function totalCart(){const myCart=JSON.parse(window.localStorage.getItem("products"));let total=0;for(let ele of myCart)total+=parseInt(ele.quantity)*parseFloat(ele.price/100);return total}function checkIsInCart(array,object){let valid=!0;for(let ele of array)ele.id==object.id&&ele.color==object.color&&(confirm("Cet article est déjà présent dans votre panier. Souhaitez-vous augmenter la quantité ?")&&(ele.quantity+=parseInt(object.quantity),updateCart(array,{clear:!1}),divLatH2.innerHTML="Votre nounours a bien été ajouté au panier.",divLateral.classList.add("active")),valid=!1);return valid}function checkoutCart(eve){eve.preventDefault();const myCart=JSON.parse(window.localStorage.getItem("products"));let products=[];for(let ele of myCart)products.push(ele.id);const firstName=document.getElementById("firstName").value,lastName=document.getElementById("lastName").value,address=document.getElementById("address").value,city=document.getElementById("city").value,email=document.getElementById("email").value;let contact,order;sendOrder({products:products,contact:{firstName:firstName,lastName:lastName,address:address,city:city,email:email}})}async function sendOrder(array){await fetch(apiUrl+"order",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(array)}).then(response=>response.json()).then(response=>getConfirm(response))}function getConfirm(array){clearCart({confirm:!1}),window.localStorage.setItem("checkout",JSON.stringify(array)),window.location.href="confirmation.html"}function displayConfirm(array){const confirmDiv=document.querySelector(".jumbotron");createEle("h2","","","","Merci pour votre commande !",confirmDiv),createEle("p","","","","Cher "+array.contact.firstName+",<br>nous avons le plaisir de vous confirmer que votre commande a bien été prise en compte.",confirmDiv),createEle("p","","","","N° de commande :",confirmDiv),createEle("h3","","","",array.orderId+"<br>",confirmDiv),createEle("p","","","","<br>Vos coordonnées :",confirmDiv),createEle("h4","","","",array.contact.firstName+" "+array.contact.lastName,confirmDiv),createEle("p","","","",array.contact.address+"<br>"+array.contact.city,confirmDiv),createEle("p","","","",array.contact.email,confirmDiv),createEle("p","","","","<br>Récapitulatif de votre commande :",confirmDiv);const confirmUl=createEle("ul","",["ul-confirm","bg-secondary","text-body"],"","",confirmDiv);for(let ele of array.products)createEle("li","","",{style:"background-image:url('"+ele.imageUrl+"');"},'<span class="font-weight-bold">'+ele.name+"</span>",confirmUl)}function displayCart(){cartDiv.innerHTML="";const myCart=JSON.parse(window.localStorage.getItem("products"));for(let ele of myCart)displayProduct(ele,myCart.indexOf(ele));const totalCartDiv=document.getElementById("totalCart"),mytotalCart=totalCart();totalCartDiv.innerHTML=displayPrice(mytotalCart)}async function displayProduct(array,index){await fetch(apiUrl+array.id).then(response=>response.json()).then(nounours=>createItem(nounours,index,array.color,array.quantity))}function createItem(array,_index,_color,_quantity){const newProduct=createEle("div","",["row","py-4","cart-product"],"","",cartDiv),newDivImg=createEle("div","",["col-2","col-sm-2","col-md-2","text-center"],"","",newProduct);createEle("img","",["img-responsive"],{src:array.imageUrl,alt:"preview",width:120,height:80},"",newDivImg);const newDivInfo=createEle("div","",["col-5","col-sm-5","col-md-5","text-sm-center","text-md-left"],"","",newProduct);createEle("h2","",["product-name"],"",'<a href="product.html?myId='+array._id+'">'+array.name+"</a>",newDivInfo),createEle("p","","","","Couleur : "+_color,newDivInfo);const newProductSub=createEle("div","",["col-5","col-sm-5","col-md-5","text-sm-center","text-md-right","row"],"","",newProduct),newDivPrix=createEle("div","",["col","col-sm","col-md","text-md-right"],{style:"padding-top:5px"},"",newProductSub);createEle("h2","","","",displayPrice(array.price/100)+'&nbsp;<span class="text-muted">x</span>&nbsp;',newDivPrix);const newDivQte=createEle("div","",["col","col-sm","col-md"],"","",newProductSub);createEle("input","quantite_"+_index,["qty","form-control"],{type:"number",value:_quantity,step:1,min:1,title:"Qty",size:4,"data-index":_index},"",newDivQte);const newDivActualiser=createEle("div","",["col","col-sm","col-md","text-right"],"","",newProductSub);createEle("button","",["btn","btn-primary","a-refresh"],{"data-index":_index,"data-action":"refreshCart",title:"Actualiser le panier"},'<i class="fas fa-sync-alt"></i>',newDivActualiser);const newDivSupprimer=createEle("div","",["col","col-sm","col-md","text-right"],"","",newProductSub);createEle("button","",["btn","btn-primary"],{"data-index":_index,"data-action":"removeFromCart",title:"Supprimer ce produit"},'<i class="fa fa-trash"></i>',newDivSupprimer)}function initializeCart(){if("undefined"!=typeof Storage){null===window.localStorage.getItem("products")&&window.localStorage.setItem("products",JSON.stringify([]));const displayQtyCart=document.getElementById("qtePanier"),myCart=JSON.parse(window.localStorage.getItem("products"));let displayTotal=!1;if(0==myCart.length)displayQtyCart.style.visibility="hidden";else{displayQtyCart.style.visibility="visible",nbr=0;for(let ele of myCart)nbr+=parseInt(ele.quantity);displayQtyCart.innerHTML=nbr,displayTotal=!0}if("panier.html"==currentUrl){const mustHide=document.querySelectorAll(".mustHide");for(let ele of mustHide)ele.style.visibility=displayTotal?"visible":"hidden";const mustShow=document.querySelectorAll(".mustShow");for(let ele of mustShow)ele.style.visibility=displayTotal?"hidden":"visible"}}else createEle("p","","","","Erreur : impossible d'initialiser le panier. Veuillez essayer ultérieurement. Si le problème persiste, merci de contacter l'administrateur du site.",mainDiv)}function updateCart(array,options){window.localStorage.removeItem("products"),options.clear||window.localStorage.setItem("products",JSON.stringify(array.sort())),"panier.html"==currentUrl&&(initializeCart(),displayCart())}initializeCart(),document.addEventListener("click",(function(e){if(e.target)switch(e.target.dataset.action){case"addToCart":e.preventDefault();const myColor=document.getElementById("selectColor"),myQty=document.getElementById("inputQty");addToCart({id:e.target.dataset.id,quantity:parseInt(myQty.value),color:myColor.value,price:e.target.dataset.price});break;case"refreshCart":e.preventDefault();const myIndex=e.target.dataset.index,myNewQty=document.getElementById("quantite_"+myIndex);refreshCart({index:myIndex,quantity:myNewQty.value});break;case"removeFromCart":e.preventDefault(),removeFromCart(e.target.dataset.index);break;case"clearCart":e.preventDefault(),clearCart({confirm:!0})}})),document.addEventListener("change",(function(e){e.target.classList.contains("qty")&&refreshCart({index:e.target.dataset.index,quantity:e.target.value})}));
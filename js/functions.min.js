const currentUrl=window.location.pathname.split("/").pop(),queryString=window.location.search,urlParams=new URLSearchParams(queryString),myId=null===urlParams.get("myId")?"":urlParams.get("myId"),myUrl=null===urlParams.get("myUrl")?"":urlParams.get("myUrl"),mainDiv=document.querySelector("main"),cartDiv=document.getElementById("cartDiv"),divLateral=createEle("div","div-lateral",["p-2"],"",""),divLatHeader=createEle("div","",["mt-2","mb-2","text-white","text-right"],"","",divLateral);createEle("a","closeLateral","",{href:"#",title:"Fermer cette fenêtre"},'<i class="far fa-times-circle"></i>',divLatHeader);const divLatBody=createEle("div","",["mt-4","mb-4","text-white"],"","",divLateral),divLatH2=createEle("h2","lateralH2","","","",divLatBody);createEle("a","","",{href:"panier.html",title:"Rendez-vous sur la page de votre panier."},"<u>Voir mon panier</u>",divLatBody);const apiUrl_tmp="http://localhost:3000/api/teddies/",apiUrl="https://oc-p5-api.herokuapp.com/api/teddies/";function displayOneCard(array,options){const newOneCard=createEle("div","mainOneCard",["row","align-items-center","my-5"],"","");switch(options.pend){case"prepend":mainDiv.prepend(newOneCard);break;default:mainDiv.appendChild(newOneCard)}const newImgDiv=createEle("div","",["col-lg-7"],"","",newOneCard);createEle("img","",["img-fluid","rounded","mb-4","mb-lg-0"],{src:array.imageUrl},"",newImgDiv);const newInfoDiv=createEle("div","",["col-lg-5"],"","",newOneCard);createEle("h1","","","","<span>"+array.name+"</span><span>"+displayPrice(array.price/100)+"<span>",newInfoDiv),createEle("p","","","",array.description,newInfoDiv);const newLabelColor=createEle("label","","",{for:"selectColor"},"Couleurs disponibles : ",newInfoDiv),newSelectColor=createEle("select","selectColor","",{name:"selectColor",dir:"ltr"},"",newLabelColor);for(let ele of array.colors)createEle("option","","","",ele,newSelectColor);const newLabelQty=createEle("label","","",{for:"inputQty"},"Quantité : ",newInfoDiv),newSelectQty=createEle("select","inputQty","",{name:"inputQty",dir:"ltr"},"",newLabelQty);for(let i=1;i<1e3;i++)createEle("option","","","",i,newSelectQty);createEle("a","addToCart",["btn","btn-primary"],{"data-id":array._id,"data-price":array.price,"data-action":"addToCart"},'<i class="fas fa-cart-plus"></i> Ajouter au panier',newInfoDiv)}async function getOneProduct(pend){await fetch(apiUrl+myId).then(response=>response.json()).then(nounours=>displayOneCard(nounours,{pend:pend}))}function displayAllCard(array,options){let nbTmp=0,mainProducts=createEle("div","",["row","text-center"],"","",mainDiv);for(let ele of array)if(ele._id!=myId&&nbTmp<options.nbMax){const newArticle=createEle("div","",["col-lg-4","col-md-6","mb-4"],"","",mainProducts),newCard=createEle("div","",["card","h-100"],"","",newArticle);createEle("img","",["card-img-top"],{src:ele.imageUrl,alt:ele.name},"",newCard);const newInfoDiv=createEle("div","",["card-body"],"","",newCard);createEle("h2","",["card-title"],"",ele.name,newInfoDiv),createEle("p","",["card-text"],"",ele.description,newInfoDiv);const newFooter=createEle("div","",["card-footer"],"","",newCard),newButton=createEle("a","","",{href:"product.html?myId="+ele._id},"",newFooter);createEle("button","",["btn","btn-primary"],"",'<i class="far fa-eye"></i> Découvrir !',newButton),nbTmp++}}async function getAllProducts(options){let loading=document.querySelector(".loading");await fetch(apiUrl).then(response=>response.json()).then(nounours=>{setTimeout(()=>{loading.remove(),displayAllCard(nounours,{nbMax:""!=options.nbMax?options.nbMax:nounours.length})},1e3)}).catch(error=>{console.log(error)})}function createEle(_type="div",_id="",_class=[],_attribute=[],_content="",_parent){const e=document.createElement(_type);if(""!=_id&&e.setAttribute("id",_id),Array.isArray(_class)&&0!=_class.length)for(let ele of _class)e.classList.add(ele);if(0!=_attribute.length)for(const[key,value]of Object.entries(_attribute))e.setAttribute(key,value);return""!=_content&&(e.innerHTML=_content),void 0!==_parent&&null!=_parent&&_parent.appendChild(e),e}function displayPrice(_price){const newPrice=new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(_price);return newPrice}function checkForm(){let result=!0;const inputs=document.getElementById("mainForm").querySelectorAll("input");return inputs.forEach(element=>{element.classList.remove("invalide");let regExTest="";switch(element.getAttribute("type")){case"text":regExTest=/^[a-zA-Z0-9 ']*$/;break;case"email":regExTest=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;break;default:regExTest=/^[a-zA-Z0-9]*$/}regExTest.test(element.value)||(element.classList.add("invalide"),result="false")}),console.log(result),result}window.addEventListener("load",(function(){switch(currentUrl){case"":case"index.html":getAllProducts({nbMax:""});break;case"product.html":""!=myId?(getOneProduct("prepend"),getAllProducts({nbMax:3})):window.location.href="index.html";break;case"panier.html":displayCart();const mainForm=document.getElementById("mainForm");mainForm.addEventListener("submit",(function(eve){eve.preventDefault(),letsGo=checkForm(),!0===letsGo&&checkoutCart()}));break;case"confirmation.html":null!==window.localStorage.getItem("checkout")?(displayConfirm(JSON.parse(window.localStorage.getItem("checkout"))),window.localStorage.removeItem("checkout")):window.location.href="index.html"}})),"panier.html"!=currentUrl&&document.body.prepend(divLateral),document.addEventListener("click",(function(e){"closeLateral"==e.target.id&&(e.preventDefault(),divLateral.classList.remove("active"))}));